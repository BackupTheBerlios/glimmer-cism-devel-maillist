<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Glimmer-cism-devel] glimmer test suite
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/glimmer-cism-devel/2010-October/index.html" >
   <LINK REL="made" HREF="mailto:glimmer-cism-devel%40lists.berlios.de?Subject=Re%3A%20%5BGlimmer-cism-devel%5D%20glimmer%20test%20suite&In-Reply-To=%3C4CA9E4A4.109%40ed.ac.uk%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000360.html">
   <LINK REL="Next"  HREF="000362.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Glimmer-cism-devel] glimmer test suite</H1>
    <B>Magnus Hagdorn</B> 
    <A HREF="mailto:glimmer-cism-devel%40lists.berlios.de?Subject=Re%3A%20%5BGlimmer-cism-devel%5D%20glimmer%20test%20suite&In-Reply-To=%3C4CA9E4A4.109%40ed.ac.uk%3E"
       TITLE="[Glimmer-cism-devel] glimmer test suite">Magnus.Hagdorn at ed.ac.uk
       </A><BR>
    <I>Mon Oct  4 16:28:52 CEST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="000360.html">[Glimmer-cism-devel] glimmer test suite
</A></li>
        <LI>Next message: <A HREF="000362.html">[Glimmer-cism-devel] glimmer test suite
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#361">[ date ]</a>
              <a href="thread.html#361">[ thread ]</a>
              <a href="subject.html#361">[ subject ]</a>
              <a href="author.html#361">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Sarah Shannon wrote:
&gt;<i> Hi Magnus and developers,
</I>&gt;<i> 
</I>&gt;<i> The test script is now checked into 
</I>&gt;<i> <A HREF="http://svn.berlios.de/wsvn/glimmer-cism/glimmer-cism-lanl/trunk.">http://svn.berlios.de/wsvn/glimmer-cism/glimmer-cism-lanl/trunk.</A>
</I>&gt;<i> It is called automatic_test.sh located in /tests/utils/
</I>&gt;<i> 
</I>&gt;<i> To get help on how to invoke the test,  type 'make test' in the head 
</I>&gt;<i> directory.
</I>&gt;<i> 
</I>&gt;<i> The tests which currently work are:
</I>&gt;<i> 
</I>&gt;<i> 1. EISMINT-1 moving margin experiments 1,2 and 3.
</I>&gt;<i> 2. The hump test using the Payne/Price or the Pattyn/Bocek/Johonson solvers
</I>&gt;<i> 3. ISMIP-HOM tests A and C using the Payne/Price solver.
</I>&gt;<i> 
</I>&gt;<i> For the ISMIP-HOM tests, I used the python script and configuration 
</I>&gt;<i> files for experiments A and C which were already in the tests2 
</I>&gt;<i> directory. Would it be useful to add the other ISMIP-HOM tests for both 
</I>&gt;<i> the Payne/Price and the Pattyn/Bocek/Johonson solvers as well?
</I>&gt;<i> 
</I>&gt;<i> The test directory contains configuration files for petermann, ross and 
</I>&gt;<i> shelf tests. The script does not run these tests at the moment.  Perhaps 
</I>&gt;<i> you could checkout the code and see if you can run a test?
</I>&gt;<i> 
</I>&gt;<i> Let me know if you spot any places where improvements can be made.
</I>&gt;<i> 
</I>&gt;<i> 
</I>
Hi Sarah,
there are a number of issues with your test suite implementation:
1. the gold versions shouldn't be under version control. these data 
files considerably contribute to the size of the project in subversion. 
We have only limited space. Also some people might not like to have to 
download the netCDF files all the time. We can think about where they 
should live later, but I am sure we can find some server with enough 
space/bandwidth to serve a tar-ball containing the gold standard.

2. you are making the automatic_test.sh more complicated than you need 
to. Have a look at the current trunk:
<A HREF="https://magi@svn.berlios.de/svnroot/repos/glimmer-cism/glimmer-cism2/trunk">https://magi@svn.berlios.de/svnroot/repos/glimmer-cism/glimmer-cism2/trunk</A>

the tests directory has a number of subdirectories with various test 
setups. Let's have a look at the EISMINT-1 tests in the directory
tests/EISMINT/EISMINT-1
All tests are controlled by make. So the Makefile.am specifies a a data 
macro containing all the names of the output files generated by each 
test setup. The Makefile includes the toplevel file extra_rules.am which 
defines a make rule to generate a netcdf output file given a 
configuration file. The make rule uses a python wrapper to either launch 
the model directly or via qsub. The python wrapper can also handle 
dependencies.

So, all you need to do is to write another rule which does the 
comparison, for example

compare-%:	%.nc
		$(top_builddir)/utils/compare $&lt; \
                 $(PATH_TO_GOLD_STANDARD)/path/to/exp/$&lt;

where the macro PATH_TO_GOLD_STANDARD is set by configure to the 
top-level directory where all the gold standard files are installed. You 
still need to figure out the path/to/exp which is just the difference 
between $(top_builddir) and $(builddir) (there might already be a macro 
for that, or some suitable shell trickery will give you it).

running make compare-e1-fm.1 would then run the test if necessary and 
then compare it against the gold standard. it might be an idea to output 
whether it failed or not. a wrapper will be necessary to make use of the 
SGE stuff, but we can sort that out once the basics work.

I hope this makes sense to you and please don't hesitate for further 
details.

magi




-- 
The University of Edinburgh is a charitable body, registered in
Scotland, with registration number SC005336.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000360.html">[Glimmer-cism-devel] glimmer test suite
</A></li>
	<LI>Next message: <A HREF="000362.html">[Glimmer-cism-devel] glimmer test suite
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#361">[ date ]</a>
              <a href="thread.html#361">[ thread ]</a>
              <a href="subject.html#361">[ subject ]</a>
              <a href="author.html#361">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/glimmer-cism-devel">More information about the Glimmer-cism-devel
mailing list</a><br>
</body></html>
