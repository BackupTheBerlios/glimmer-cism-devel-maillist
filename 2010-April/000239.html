<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Glimmer-cism-devel] merging plume_integration into	glimmer-cism-lanl/trunk
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/glimmer-cism-devel/2010-April/index.html" >
   <LINK REL="made" HREF="mailto:glimmer-cism-devel%40lists.berlios.de?Subject=Re%3A%20%5BGlimmer-cism-devel%5D%20merging%20plume_integration%20into%0A%09glimmer-cism-lanl/trunk&In-Reply-To=%3Cw2m8a364a0f1004300833za1b0385axbe7e8824a646baeb%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000234.html">
   <LINK REL="Next"  HREF="000235.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Glimmer-cism-devel] merging plume_integration into	glimmer-cism-lanl/trunk</H1>
    <B>Carl Gladish</B> 
    <A HREF="mailto:glimmer-cism-devel%40lists.berlios.de?Subject=Re%3A%20%5BGlimmer-cism-devel%5D%20merging%20plume_integration%20into%0A%09glimmer-cism-lanl/trunk&In-Reply-To=%3Cw2m8a364a0f1004300833za1b0385axbe7e8824a646baeb%40mail.gmail.com%3E"
       TITLE="[Glimmer-cism-devel] merging plume_integration into	glimmer-cism-lanl/trunk">gladish at cims.nyu.edu
       </A><BR>
    <I>Fri Apr 30 17:33:47 CEST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="000234.html">[Glimmer-cism-devel] merging plume_integration	into	glimmer-cism-lanl/trunk
</A></li>
        <LI>Next message: <A HREF="000235.html">[Glimmer-cism-devel] merging plume_integration	into	glimmer-cism-lanl/trunk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#239">[ date ]</a>
              <a href="thread.html#239">[ thread ]</a>
              <a href="subject.html#239">[ subject ]</a>
              <a href="author.html#239">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi everyone,

I see the beta release has been carried out.  If no one objects I'd like to
carry out the plume merge at this point.  It is a very easy and minor merge,
in my opinion.

The changes consist of the file additions listed below, and diffs to the
existing code which are in the attached file.

A      src/fortran/plume_global.F90
A      src/fortran/plume_functions.F90
A      src/fortran/plume_main.F90
A      src/fortran/plume_io.F90
A      src/fortran/plume_context.F90
A      src/fortran/plume.F90
A  +   tests/petermann
A      tests/petermann/build_case.py
A      tests/petermann/test.config
A  +   tests/petermann/sample.gs.config.py
A      tests/petermann/test.nl
A      tests/petermann/build_nc_gen_input
A      tests/petermann/nc_regrid.F90
A      tests/petermann/petermann.config
A      tests/petermann/ideal_geometry.config
A      tests/petermann/README
A      tests/petermann/standalone.nl
A      tests/petermann/partgrounded.nc_gen_args
A      tests/petermann/make_ncdf_shelf_input.m
A      tests/petermann/partgrounded.config
A      tests/petermann/ideal_peterman.config.py
A      tests/petermann/nc_gen_input.F90
A      tests/petermann/partgrounded.nl
A      tests/petermann/build_nc_regrid
A      tests/petermann/sample.config.py


On Wed, Apr 21, 2010 at 10:54 AM, Stephen Price &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/glimmer-cism-devel">sprice at lanl.gov</A>&gt; wrote:

&gt;<i>
</I>&gt;<i> Thanks Carl, Magi ...
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  I am not in a position to give you the go-ahead for merging your changes
</I>&gt;&gt;<i> to glimmer-cism-lanl-trunk. You should ask  Jesse, Bill and/or Steve. This
</I>&gt;&gt;<i> might not be the best of times since a beta release is prepared. On the
</I>&gt;&gt;<i> other hand it might be a good time. Anyway, it's not my call.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> My preference would be to wait until after the release, which should happen
</I>&gt;<i> today or tomorrow, I hope.
</I>&gt;<i>
</I>&gt;<i> We then need to have a discussion about the various planned merges taking
</I>&gt;<i> place with the folks who will be doing that work. Perhaps it will be trivial
</I>&gt;<i> to merge the plume code onto the lanl branch just after the beta release,
</I>&gt;<i> and then continue on from there with the rest of the merging plans. But I'd
</I>&gt;<i> rather not commit to that right now. Give us a few more days and we'll have
</I>&gt;<i> some time to look at it more closely.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Steve
</I>&gt;<i>
</I>&gt;<i>
</I>

-- 
Carl Gladish
cell: (917) 502 - 1818
home: (718) 626 - 2504
office: (212) 998 - 3198
Warren Weaver Hall rm 708, 251 Mercer NY,NY
<A HREF="http://www.cims.nyu.edu/~gladish">http://www.cims.nyu.edu/~gladish</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="https://lists.berlios.de/pipermail/glimmer-cism-devel/attachments/20100430/31565f99/attachment.html">https://lists.berlios.de/pipermail/glimmer-cism-devel/attachments/20100430/31565f99/attachment.html</A>&gt;
-------------- next part --------------
Index: configure.in
===================================================================
--- configure.in	(revision 1640)
+++ configure.in	(working copy)
@@ -296,6 +296,17 @@
 esac],[AC_MSG_RESULT([no])])
 AM_CONDITIONAL([BUILD_RESTARTS],[test &quot;$enable_restarts&quot; == &quot;yes&quot;])
 
+# should we build the plume code
+AC_MSG_CHECKING([whether we should build plume code])
+AC_ARG_ENABLE(plume, AS_HELP_STRING([--enable-plume],[Build plume code]),
+[case &quot;${enableval}&quot; in
+ yes) AC_DEFINE(BUILD_PLUME,1,[Define to 1 if you want to build plume code])
+      AC_MSG_RESULT([yes]);;
+ no)  AC_MSG_RESULT([no]);;
+ *) AC_MSG_ERROR(bad value ${enableval} for --enable-plume) ;;
+esac], [AC_MSG_RESULT([no])])
+AM_CONDITIONAL([BUILD_PLUME], [test &quot;$enable_plume&quot; == &quot;yes&quot;])
+
 AC_MSG_CHECKING([whether the build is single precision])
 AC_ARG_ENABLE(sp, AS_HELP_STRING([--enable-sp],[Build code as single precision]),
 [case &quot;${enableval}&quot; in
Index: src/fortran/Makefile.am
===================================================================
--- src/fortran/Makefile.am	(revision 1640)
+++ src/fortran/Makefile.am	(working copy)
@@ -86,6 +86,18 @@
                        eismint3_io.F90 spin_forcing.F90 spin_mb.F90 \
                        spin_temp.F90 spin_slc.F90 spin_io.F90 \
                        testsfg.F90 spin_types.F90 
+
+if BUILD_PLUME
+lib_LIBRARIES += libplume.a
+bin_PROGRAMS += shelf_driver
+libplume_a_SOURCES = plume_global.F90 plume_functions.F90 plume_context.F90 \
+                     plume.F90 plume_io.F90
+shelf_driver_SOURCES = shelf_driver.F90 
+shelf_driver_LDADD = libclimate.a libglide.a libglimmer.a \
+	             SLAP_library/libslap.a libplume.a \
+                     $(BLAS_LIBS) $(NETCDF_LDFLAGS) $(NETCDF_LIBS) 
+endif BUILD_PLUME
+
 if PARDISO
 RESTART_CODE += glimmer_sparse_pardiso.F90
 libglimmer_a_SOURCES += glimmer_sparse_pardiso.F90
@@ -130,7 +142,7 @@
         $(test_config_SOURCES) $(nc2config_SOURCES) $(glex_ebm_SOURCES) $(glint_example_SOURCES) \
 	$(eis_glide_SOURCES) $(simple_glide_SOURCES) $(eismint3_glide_SOURCES) $(libglimmer_a_SOURCES) \
 	$(libglide_a_SOURCES) $(libglint_a_SOURCES) $(libclimate_a_SOURCES) $(spin_glide_SOURCES) \
-        $(glimmer_unittest_SOURCES) $(glide_thermal_equib_SOURCES)
+        $(glimmer_unittest_SOURCES) $(glide_thermal_equib_SOURCES) $(libplume_a_SOURCES) $(shelf_driver_SOURCES)
 
 AM_FCFLAGS = $(NETCDF_CPPFLAGS) $(HDF5_CPPFLAGS)
 
Index: src/fortran/glam_strs2.F90
===================================================================
--- src/fortran/glam_strs2.F90	(revision 1640)
+++ src/fortran/glam_strs2.F90	(working copy)
@@ -210,7 +210,7 @@
   integer, intent(in) :: whichsparse  ! options for which method for doing elliptic solve
   logical, intent(in) :: periodic_ew, periodic_ns  ! options for applying periodic bcs or not
 
-  real (kind = dp), dimension(:,:,:), intent(out) :: uvel, vvel  ! horiz vel components: u(z), v(z)
+  real (kind = dp), dimension(:,:,:), intent(inout) :: uvel, vvel  ! horiz vel components: u(z), v(z)
   real (kind = dp), dimension(:,:),   intent(out) :: uflx, vflx  ! horiz fluxs: u_bar*H, v_bar*H
   real (kind = dp), dimension(:,:,:), intent(out) :: efvs        ! effective viscosity
 
Index: src/fortran/glide_temp.F90
===================================================================
--- src/fortran/glide_temp.F90	(revision 1640)
+++ src/fortran/glide_temp.F90	(working copy)
@@ -933,7 +933,7 @@
     type(glide_global_type) :: model
     real(dp), dimension(:,0:,0:), intent(in) :: temp
     real(dp), dimension(:,:), intent(in) :: thck,  stagthck, dusrfdew, dusrfdns, ubas, vbas  
-    real(dp), dimension(:,:), intent(out) :: bmlt
+    real(dp), dimension(:,:), intent(inout) :: bmlt
     logical, dimension(:,:), intent(in) :: floater
     integer, intent(in) :: whichbmelt
 
@@ -1038,10 +1038,13 @@
 
              end if
 
-          else
+          else if (model%options%use_plume == 1) then
 
-             bmlt(ew,ns) = 0.0d0
+		! do nothing because the plume model will have written the bmlt field
+	       else
 
+                  bmlt(ew,ns) = 0.0d0
+
           end if
        end do
     end do
Index: src/fortran/glide_setup.F90
===================================================================
--- src/fortran/glide_setup.F90	(revision 1640)
+++ src/fortran/glide_setup.F90	(working copy)
@@ -410,6 +410,7 @@
     call GetValue(section,'periodic_ew',model%options%periodic_ew)
     call GetValue(section,'periodic_ns',model%options%periodic_ns)
     call GetValue(section,'diagnostic_run',model%options%diagnostic_run)
+    call GetValue(section, 'use_plume',model%options%use_plume)
   end subroutine handle_options
   
   !Higher order options
@@ -588,6 +589,11 @@
     if (model%options%hotstart.eq.1) then
        call write_log('Hotstarting model')
     end if
+    if (model%options%use_plume.eq.1) then
+       call write_log('Using plume model to calculate bmlt below floating ice')
+    else
+       call write_log('Using glimmer to calculate bmlt everywhere')
+    end if
 
     !HO options
     call write_log(&quot;***Higher-order options:&quot;)
Index: src/fortran/glide_types.F90
===================================================================
--- src/fortran/glide_types.F90	(revision 1640)
+++ src/fortran/glide_types.F90	(working copy)
@@ -394,6 +394,12 @@
 
     integer :: diagnostic_run = 0
 
+    integer :: use_plume = 0
+    !*FD \begin{description}
+    !*FD \item[0] standard bmlt calculation
+    !*FD \item[1] use plume to calculate bmlt
+    !*FD \end{description}
+
   end type glide_options
 
   !++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000234.html">[Glimmer-cism-devel] merging plume_integration	into	glimmer-cism-lanl/trunk
</A></li>
	<LI>Next message: <A HREF="000235.html">[Glimmer-cism-devel] merging plume_integration	into	glimmer-cism-lanl/trunk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#239">[ date ]</a>
              <a href="thread.html#239">[ thread ]</a>
              <a href="subject.html#239">[ subject ]</a>
              <a href="author.html#239">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/glimmer-cism-devel">More information about the Glimmer-cism-devel
mailing list</a><br>
</body></html>
